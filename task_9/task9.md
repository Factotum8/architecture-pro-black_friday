# Products

|                        **Операция**                        | **Реплика**                             |
|:----------------------------------------------------------:|:----------------------------------------|
|             Обновления остатков при покупках.              | primary                                 |
| Поиск товаров по категориям и фильтрация по диапазону цен. | secondary  (задержка репликации до 1 ч) |
|            Описание товара на странице продукта            | secondary                               |

Простая политика операции на запись в primary. Это каноническое решение. 
Так же мы можем позволить себе долгое обновление описания товара и цены так как это не критически важные операции. 

# Orders

|                              **Операция**                              | **Реплика**                                 |
|:----------------------------------------------------------------------:|:--------------------------------------------|
|      Быстрое создание заказов с одновременным списанием остатков.      | primary                                     |
|            Поиск истории заказов конкретного пользователя.             | secondary (задержка репликации до 20 минут) |
|                      Отображение статуса заказа.                       | secondary                                   |

Как и в случае выше запись в primary. 
Поставил меньшую задержку на репликацию так как статус заказа доступен покупателю и скорость его обновления влияет на пользовательский опыт. 

# Carts

|                                        **Операция**                                         | **Реплика**                                 |
|:-------------------------------------------------------------------------------------------:|:--------------------------------------------|
|                Создание корзины, когда заходит гость или новый пользователь.                | primary                                     |
| Запрос корзины по фильтру { session_id, status:"active" } или { user_id, status:"active" }. | secondary (задержка репликации до 15 минут) |
|                           Добавление или замена товара в корзине.                           | primary                                     |
|                                 Удаление товара из корзины.                                 | primary                                     |
|                     Прочитать гостевую { session_id, status:"active" }.                     | secondary                                   |
|                  Добавить её items в корзину { user_id, status:"active" }.                  | primary                                     |
|                              Отметить гостевую как abandoned.                               | primary                                     |
|                               Отметка корзины как заказанной.                               | primary                                     |

Самый критичный кейс. Скорость работы с корзиной сильно влияет на пользовательский опыт и воронку продаж.
Все операции записи в primary. Операции чтения с secondary. 
Созданная покупателем корзина будет лежать в кэш его приложения и читать её с secondary (где её ещё нет) не придётся, 
поэтому допустимое время репликации 15 минут. 
